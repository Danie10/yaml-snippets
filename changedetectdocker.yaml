services:
  changedetection:
    image: ghcr.io/dgtlmoon/changedetection.io
    container_name: changedetection
    hostname: changedetection
    volumes:
      - /srv/dev-disk-by-uuid-e6c3b71f-ef88-4055-a599-fb607c4baed2/data/appdata/Config/changedetection-data:/datastore
    environment:
      - PUID=998
      - PGID=100
      - TZ=Africa/Johannesburg
#      - WEBDRIVER_URL=http://browser-chrome:4444/wd/hub
#       Alternative Playwright URL, do not use "'s or 's!
      - PLAYWRIGHT_DRIVER_URL=ws://playwright-chrome:3000/?stealth=1&--disable-web-security=true
  #       Playwright proxy settings playwright_proxy_server, playwright_proxy_bypass, playwright_proxy_username, playwright_proxy_password
  #
  #             https://playwright.dev/python/docs/api/class-browsertype#browser-type-launch-option-proxy
  #
  #        Plain requests - proxy support example.
  #      - HTTP_PROXY=socks5h://10.10.1.10:1080
  #      - HTTPS_PROXY=socks5h://10.10.1.10:1080
  #
  #        An exclude list (useful for notification URLs above) can be specified by with
  #      - NO_PROXY="localhost,192.168.0.0/24"
  #
  #        Base URL of your changedetection.io install (Added to the notification alert)
  #      - BASE_URL=https://mysite.com
  #        Respect proxy_pass type settings, `proxy_set_header Host "localhost";` and `proxy_set_header X-Forwarded-Prefix /app;`
  #        More here https://github.com/dgtlmoon/changedetection.io/wiki/Running-changedetection.io-behind-a-reverse-proxy-sub-directory
  #      - USE_X_SETTINGS=1
  #
  #        Hides the `Referer` header so that monitored websites can't see the changedetection.io hostname.
      - HIDE_REFERER=true
  #        
  #        Default number of parallel/concurrent fetchers
  #      - FETCH_WORKERS=10
    # Comment out ports: when using behind a reverse proxy , enable networks: etc.
    ports:
      - 5000:5000
    labels:
      # Optional if you want Watchtower notifications
      com.centurylinklabs.watchtower.enable: "true"
      # Optional for What's Up Docker updates
      wud.display.name: Changedetection
      wud.tag.include: ^\d+\.(\d+)\.(\d+)$ # watch y.z tags only
    restart: unless-stopped
    depends_on:
      playwright-chrome:
        condition: service_started

     # Used for fetching pages via Playwright+Chrome where you need Javascript support.
     # Note: Playwright/browserless not supported on ARM type devices (rPi etc)
     # RECOMMENDED FOR FETCHING PAGES WITH CHROME
  playwright-chrome:
    hostname: playwright-chrome
    #   image: browserless/chrome:1.60-chrome-stable
    image: dgtlmoon/sockpuppetbrowser:latest
    #image: browserless/chrome:latest
    cap_add:
        - SYS_ADMIN
    container_name: playwright-chrome
    restart: unless-stopped
#    network_mode: host
    environment:
      - SCREEN_WIDTH=1920
      - SCREEN_HEIGHT=1024
      - SCREEN_DEPTH=16
      - ENABLE_DEBUGGER=false
      - PREBOOT_CHROME=true
      - CONNECTION_TIMEOUT=300000
      - MAX_CONCURRENT_SESSIONS=10
      - CHROME_REFRESH_TIME= 600000
      - DEFAULT_BLOCK_ADS=true
      - DEFAULT_STEALTH=true
      - DEFAULT_IGNORE_HTTPS_ERRORS=true
      - FAST_PUPPETEER_CHROME_FETCHER=true
    labels:
      com.centurylinklabs.watchtower.enable: "true"
      wud.display.name: Changedetection Playwright Chrome
      wud.tag.include: ^\d+\.(\d+)\.(\d+)$ # watch y.z tags only
